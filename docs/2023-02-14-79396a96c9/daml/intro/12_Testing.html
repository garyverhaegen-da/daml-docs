<!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Test Daml Contracts &mdash; Daml SDK 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
  <script src="../../_static/jquery.js"></script>
  <script src="../../_static/underscore.js"></script>
  <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
  <script src="../../_static/doctools.js"></script>
  <script src="../../_static/clipboard.min.js"></script>
  <script src="../../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Add Constraints to a Contract" href="5_Restrictions.html" />
  <link rel="prev" title="Exception Handling" href="8_Exceptions.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Daml Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/app-arch.html"> app-dev/app-arch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/index.html"> app-dev/bindings-ts/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html">Use the JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html"> app-dev/bindings-ts/daml-react</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html"> app-dev/bindings-ts/daml-types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html"> app-dev/bindings-ts/daml-ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html"> app-dev/bindings-ts/daml2js</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/parties-users.html"> app-dev/parties-users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/grpc/index.html"> app-dev/grpc/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/grpc/error-codes.html"> app-dev/grpc/error-codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/grpc/proto-docs.html"> app-dev/grpc/proto-docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html"> app-dev/grpc/daml-to-ledger-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/services.html"> app-dev/services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html"> app-dev/bindings-x-lang/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/daml-lf-translation.html"> app-dev/daml-lf-translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-python.html"> app-dev/bindings-python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/command-deduplication.html"> app-dev/command-deduplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/ledger-api.html"> app-dev/ledger-api</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/services.html">The Ledger API Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/parties-users.html">Parties and Users On a Daml Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/index.html">Use the Ledger API With gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/error-codes.html">Error Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/proto-docs.html">Ledger API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html">How Daml Types are Translated to Protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/daml-lf-translation.html">How Daml Types are Translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html">Create Your Own Bindings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/custom-views/index.html"> app-dev/custom-views/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/authorization.html"> app-dev/authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-java/index.html"> app-dev/bindings-java/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html">Generate Java Code from Daml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html"> app-dev/bindings-java/codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html"> app-dev/bindings-java/quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app-dev/bindings-java/example.html"> app-dev/bindings-java/example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/index.html"> json-api/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/lf-value-specification.html"> json-api/lf-value-specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/search-query-language.html"> json-api/search-query-language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/security-and-privacy.html"> json-api/production-setup/security-and-privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/scaling-and-redundancy.html"> json-api/production-setup/scaling-and-redundancy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/metrics.html"> json-api/production-setup/metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/query-store.html"> json-api/production-setup/query-store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/logging.html"> json-api/production-setup/logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup/architecture.html"> json-api/production-setup/architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json-api/production-setup.html"> json-api/production-setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/index.html"> upgrade/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/extend.html">Extending Daml Applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/upgrade.html">Upgrading Daml Applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/extend.html"> upgrade/extend</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/upgrade.html"> upgrade/upgrade</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade/automation.html"> upgrade/automation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/auth-middleware/index.html"> tools/auth-middleware/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/auth-middleware/oauth2.html"> tools/auth-middleware/oauth2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/canton-console.html"> tools/canton-console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/trigger-service/index.html"> tools/trigger-service/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/trigger-service/auth0_example.html"> tools/trigger-service/auth0_example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/trigger-service/authorization.html"> tools/trigger-service/authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/assistant.html"> tools/assistant</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/codegen.html"> tools/codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/non-repudiation.html"> tools/non-repudiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/visual.html"> tools/visual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/navigator/index.html"> tools/navigator/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/sandbox.html"> tools/sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/profiler.html"> tools/profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/export/index.html"> tools/export/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-off-ledger.html"> daml-off-ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/index.html"> triggers/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/api/index.html">Daml Trigger Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger.html">Daml.Trigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger-Assert.html">Daml.Trigger.Assert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/Daml-Trigger-LowLevel.html">Daml.Trigger.LowLevel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/api/index.html"> triggers/api/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/api/Daml-Trigger.html">Daml.Trigger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/api/Daml-Trigger-Assert.html">Daml.Trigger.Assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/api/Daml-Trigger-LowLevel.html">Daml.Trigger.LowLevel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/api/Daml-Trigger-LowLevel.html"> triggers/api/Daml-Trigger-LowLevel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/api/Daml-Trigger-Assert.html"> triggers/api/Daml-Trigger-Assert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../triggers/api/Daml-Trigger.html"> triggers/api/Daml-Trigger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploy/generic_ledger.html"> deploy/generic_ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-repl/index.html"> daml-repl/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../considerations.html"> daml/considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml-studio.html"> daml/daml-studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/locking.html"> daml/patterns/locking</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../patterns/locking/locking-by-archiving.html">Lock by Archiving</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/locking/locking-by-state.html">Lock by State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/locking/locking-by-safekeeping.html">Lock by Safekeeping</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/initaccept.html"> daml/patterns/initaccept</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/multiparty-agreement.html"> daml/patterns/multiparty-agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/locking/locking-by-safekeeping.html"> daml/patterns/locking/locking-by-safekeeping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/locking/locking-by-state.html"> daml/patterns/locking/locking-by-state</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/locking/locking-by-archiving.html"> daml/patterns/locking/locking-by-archiving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/legends.html"> daml/patterns/legends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/delegation.html"> daml/patterns/delegation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns/authorization.html"> daml/patterns/authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_Data.html"> daml/intro/3_Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_Exceptions.html"> daml/intro/8_Exceptions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> daml/intro/12_Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_Restrictions.html"> daml/intro/5_Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_Parties.html"> daml/intro/6_Parties</a></li>
<li class="toctree-l1"><a class="reference internal" href="99_NextSteps.html"> daml/intro/99_NextSteps</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_DamlScript.html"> daml/intro/2_DamlScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_Functional101.html"> daml/intro/10_Functional101</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_Token.html"> daml/intro/1_Token</a></li>
<li class="toctree-l1"><a class="reference internal" href="0_Intro.html"> daml/intro/0_Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_Interfaces.html"> daml/intro/13_Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_Transformations.html"> daml/intro/4_Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_Composing.html"> daml/intro/7_Composing</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_Dependencies.html"> daml/intro/9_Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_StdLib.html"> daml/intro/11_StdLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patterns.html"> daml/patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../patterns/initaccept.html">The Initiate and Accept Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/multiparty-agreement.html">The Multiple Party Agreement Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/delegation.html">The Delegation Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/authorization.html">The Authorization Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/locking.html">The Locking Pattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../patterns/locking/locking-by-archiving.html">Lock by Archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../patterns/locking/locking-by-state.html">Lock by State</a></li>
<li class="toctree-l3"><a class="reference internal" href="../patterns/locking/locking-by-safekeeping.html">Lock by Safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../patterns/legends.html">Diagram Legends</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Numeric.html"> daml/stdlib/DA-Numeric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/index.html"> daml/stdlib/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/Prelude.html">Prelude</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Action.html">DA.Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Action-State.html">DA.Action.State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Action-State-Class.html">DA.Action.State.Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Assert.html">DA.Assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Bifunctor.html">DA.Bifunctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-BigNumeric.html">DA.BigNumeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Date.html">DA.Date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Either.html">DA.Either</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Exception.html">DA.Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Foldable.html">DA.Foldable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Functor.html">DA.Functor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Internal-Interface-AnyView.html">DA.Internal.Interface.AnyView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Internal-Interface-AnyView-Types.html">DA.Internal.Interface.AnyView.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-List.html">DA.List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-List-BuiltinOrder.html">DA.List.BuiltinOrder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-List-Total.html">DA.List.Total</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Logic.html">DA.Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Map.html">DA.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Math.html">DA.Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Monoid.html">DA.Monoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-NonEmpty.html">DA.NonEmpty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-NonEmpty-Types.html">DA.NonEmpty.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Numeric.html">DA.Numeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Optional.html">DA.Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Record.html">DA.Record</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Semigroup.html">DA.Semigroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Set.html">DA.Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Stack.html">DA.Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Text.html">DA.Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-TextMap.html">DA.TextMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Time.html">DA.Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Traversable.html">DA.Traversable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Tuple.html">DA.Tuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/DA-Validation.html">DA.Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/GHC-Show-Text.html">GHC.Show.Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stdlib/GHC-Tuple-Check.html">GHC.Tuple.Check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Internal-Interface-AnyView.html"> daml/stdlib/DA-Internal-Interface-AnyView</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Action.html"> daml/stdlib/DA-Action</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Monoid.html"> daml/stdlib/DA-Monoid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Foldable.html"> daml/stdlib/DA-Foldable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-TextMap.html"> daml/stdlib/DA-TextMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Tuple.html"> daml/stdlib/DA-Tuple</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Record.html"> daml/stdlib/DA-Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Internal-Interface-AnyView-Types.html"> daml/stdlib/DA-Internal-Interface-AnyView-Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-List.html"> daml/stdlib/DA-List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-List-Total.html"> daml/stdlib/DA-List-Total</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Either.html"> daml/stdlib/DA-Either</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Traversable.html"> daml/stdlib/DA-Traversable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Optional.html"> daml/stdlib/DA-Optional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Map.html"> daml/stdlib/DA-Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-NonEmpty-Types.html"> daml/stdlib/DA-NonEmpty-Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Time.html"> daml/stdlib/DA-Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Bifunctor.html"> daml/stdlib/DA-Bifunctor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/Prelude.html"> daml/stdlib/Prelude</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Set.html"> daml/stdlib/DA-Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Semigroup.html"> daml/stdlib/DA-Semigroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Assert.html"> daml/stdlib/DA-Assert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Functor.html"> daml/stdlib/DA-Functor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Text.html"> daml/stdlib/DA-Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Logic.html"> daml/stdlib/DA-Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/GHC-Show-Text.html"> daml/stdlib/GHC-Show-Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Date.html"> daml/stdlib/DA-Date</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Action-State-Class.html"> daml/stdlib/DA-Action-State-Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-NonEmpty.html"> daml/stdlib/DA-NonEmpty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Math.html"> daml/stdlib/DA-Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-List-BuiltinOrder.html"> daml/stdlib/DA-List-BuiltinOrder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Stack.html"> daml/stdlib/DA-Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Action-State.html"> daml/stdlib/DA-Action-State</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Validation.html"> daml/stdlib/DA-Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-BigNumeric.html"> daml/stdlib/DA-BigNumeric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/GHC-Tuple-Check.html"> daml/stdlib/GHC-Tuple-Check</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stdlib/DA-Exception.html"> daml/stdlib/DA-Exception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html"> daml/troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource-management/latency-and-throughput.html"> daml/resource-management/latency-and-throughput</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource-management/index.html"> daml/resource-management/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource-management/active-contract-set.html"> daml/resource-management/active-contract-set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/templates.html"> daml/reference/templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html"> daml/reference/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/structure.html">Overview: Template Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/interfaces.html">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/working-with.html"> daml/reference/working-with</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/functions.html"> daml/reference/functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/data-types.html"> daml/reference/data-types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/choices.html"> daml/reference/choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/packages.html"> daml/reference/packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/expressions.html"> daml/reference/expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/structure.html"> daml/reference/structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contract-keys.html"> daml/reference/contract-keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/file-structure.html"> daml/reference/file-structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/updates.html"> daml/reference/updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/exceptions.html"> daml/reference/exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/interfaces.html"> daml/reference/interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html"> getting-started/index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/testing.html"> getting-started/testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/path-variables.html"> getting-started/path-variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/manual-download.html"> getting-started/manual-download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/app-architecture.html"> getting-started/app-architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/first-feature.html"> getting-started/first-feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html"> getting-started/installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/support.html"> support/support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/status-definitions.html"> support/status-definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/overview.html"> support/overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/releases.html"> support/releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/compatibility.html"> support/compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support/component-statuses.html"> support/component-statuses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/time.html"> concepts/time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/index.html"> concepts/ledger-model/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-daml.html">Daml: Define Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/ledger-privacy.html"> concepts/ledger-model/ledger-privacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/ledger-structure.html"> concepts/ledger-model/ledger-structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/ledger-integrity.html"> concepts/ledger-model/ledger-integrity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/ledger-daml.html"> concepts/ledger-model/ledger-daml</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/ledger-model/ledger-exceptions.html"> concepts/ledger-model/ledger-exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/interoperability.html"> concepts/interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/test-evidence.html"> concepts/test-evidence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/identity-and-package-management.html"> concepts/identity-and-package-management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/glossary.html"> concepts/glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/local-ledger.html"> concepts/local-ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/system_architecture_faq.html"> ops/system_architecture_faq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/requirements.html"> ops/requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/pruning.html"> ops/pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/common-metrics.html"> ops/common-metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/metering.html"> ops/metering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/index.html"> daml-script/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml-script/api/index.html">Daml Script Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml-script/api/Daml-Script.html">Daml.Script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/api/index.html"> daml-script/api/index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../daml-script/api/Daml-Script.html">Daml.Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../daml-script/api/Daml-Script.html"> daml-script/api/Daml-Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building-applications.html"> building-applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/app-arch.html">Daml Application Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-ts/index.html">Using JavaScript Client Libraries with Daml</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-ts/daml2js.html">Use the JavaScript Code Generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../json-api/index.html">HTTP JSON API Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-java/index.html">Java Bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/codegen.html">Generate Java Code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/bindings-python.html">Python Bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../daml-script/index.html">Daml Script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../daml-script/api/index.html">Daml Script Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../daml-script/api/Daml-Script.html">Daml.Script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrade/index.html">Upgrading and Extending Daml Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade/extend.html">Extending Daml Applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade/upgrade.html">Upgrading Daml Applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/services.html">The Ledger API Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/parties-users.html">Parties and Users On a Daml Ledger</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/grpc/index.html">Use the Ledger API With gRPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/grpc/error-codes.html">Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/grpc/proto-docs.html">Ledger API Reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/grpc/daml-to-ledger-api.html">How Daml Types are Translated to Protobuf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/daml-lf-translation.html">How Daml Types are Translated to Daml-LF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../app-dev/bindings-x-lang/index.html">Create Your Own Bindings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../app-dev/command-deduplication.html">Command Deduplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../triggers/index.html">Daml Triggers - Off-Ledger Automation in Daml</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../triggers/api/index.html">Daml Trigger Library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../triggers/api/Daml-Trigger.html">Daml.Trigger</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../triggers/api/Daml-Trigger-Assert.html">Daml.Trigger.Assert</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../triggers/api/Daml-Trigger-LowLevel.html">Daml.Trigger.LowLevel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tools/auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../high-level-intro.html"> high-level-intro</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../canton-refs.html">Dummy Canton Refs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../canton-refs.html#dummy-toc-refs">Dummy TOC Refs</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../../_static/images/Daml_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/developers" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Test Daml Contracts</a><ul>
<li><a class="reference internal" href="#daml-test-tooling">Daml Test Tooling</a></li>
<li><a class="reference internal" href="#debug-trace-and-stacktraces">Debug, Trace, and Stacktraces</a></li>
<li><a class="reference internal" href="#diagnose-contention-errors">Diagnose Contention Errors</a><ul>
<li><a class="reference internal" href="#common-errors">Common Errors</a><ul>
<li><a class="reference internal" href="#contractid-not-found-during-interpretation">ContractId Not Found During Interpretation</a></li>
<li><a class="reference internal" href="#contractid-not-found-during-validation">ContractId Not Found During Validation</a></li>
<li><a class="reference internal" href="#fetchbykey-error-during-interpretation">fetchByKey Error During Interpretation</a></li>
<li><a class="reference internal" href="#fetchbykey-dispute-during-validation">fetchByKey Dispute During Validation</a></li>
<li><a class="reference internal" href="#lookupbykey-dispute-during-validation">lookupByKey Dispute During Validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#avoid-race-conditions-and-stale-references">Avoid Race Conditions and Stale References</a></li>
<li><a class="reference internal" href="#collisions-due-to-ignorance">Collisions Due to Ignorance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#checking-coverage">Checking Coverage</a><ul>
<li><a class="reference internal" href="#flags-controlling-tests-and-coverage">Flags Controlling Tests and Coverage</a></li>
<li><a class="reference internal" href="#define-templates-choices-and-interfaces">Define templates, choices, and interfaces</a></li>
<li><a class="reference internal" href="#start-testing">Start testing</a></li>
<li><a class="reference internal" href="#template-creation-coverage">Template creation coverage</a></li>
<li><a class="reference internal" href="#template-choice-exercise-coverage">Template choice exercise coverage</a></li>
<li><a class="reference internal" href="#interface-choice-exercise-coverage">Interface choice exercise coverage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#checking-coverage-of-external-dependencies">Checking Coverage of External Dependencies</a><ul>
<li><a class="reference internal" href="#definitions">Definitions</a></li>
<li><a class="reference internal" href="#local-definitions">Local Definitions</a></li>
<li><a class="reference internal" href="#external-definitions">External Definitions</a></li>
<li><a class="reference internal" href="#external-internal-and-any-coverage">External, Internal, and “Any” Coverage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#next-up">Next Up</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="test-daml-contracts">
<h1>Test Daml Contracts<a class="headerlink" href="#test-daml-contracts" title="Permalink to this heading">¶</a></h1>
<p>This chapter is all about testing and debugging the Daml contracts you’ve built using the tools from earlier chapters. You’ve already met Daml Script as a way of testing your code inside the IDE. In this chapter you’ll learn about more ways to test with Daml Script and its other uses, as well as other tools you can use for testing and debugging. You’ll also learn about a few error cases that are most likely to crop up only in actual distributed testing, and which need some care to avoid. Specifically we will cover:</p>
<ul class="simple">
<li>Daml Test tooling - Script, REPL, and Navigator</li>
<li>Checking choice coverage</li>
<li>The <code class="docutils literal notranslate"><span class="pre">trace</span></code> and <code class="docutils literal notranslate"><span class="pre">debug</span></code> functions</li>
<li>Contention</li>
</ul>
<p>Note that this section only covers testing your Daml contracts. For more holistic application testing, please refer to <a class="reference internal" href="../../getting-started/testing.html"><span class="doc">Testing Your Web App</span></a>.</p>
<p>If you no longer have your projects set up, load all the code for this parts 1 and 2 of this section into two folders <code class="docutils literal notranslate"><span class="pre">intro12-part1</span></code> and <code class="docutils literal notranslate"><span class="pre">intro12-part2</span></code>, by running <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">new</span> <span class="pre">intro12-part1</span> <span class="pre">--template</span> <span class="pre">daml-intro-12-part1</span></code> and <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">new</span> <span class="pre">intro12-part2</span> <span class="pre">--template</span> <span class="pre">daml-intro-12-part2</span></code>.</p>
<div class="section" id="daml-test-tooling">
<h2>Daml Test Tooling<a class="headerlink" href="#daml-test-tooling" title="Permalink to this heading">¶</a></h2>
<p>There are three primary tools available in the SDK to test and interact with Daml contracts. It is highly recommended to explore the respective docs. The <a class="reference internal" href="9_Dependencies.html"><span class="doc">Work with Dependencies</span></a> model lends itself well to being tested using these tools.</p>
<p><a class="reference internal" href="../../daml-script/index.html"><span class="doc">Daml Script</span></a></p>
<blockquote>
<div><p><a class="reference internal" href="../../daml-script/index.html"><span class="doc">Daml Script</span></a> should be familiar by now. It’s a way to script commands and queries from multiple parties against a Daml Ledger. Unless you’ve browsed other sections of the documentation already, you have probably used it mostly in the IDE. However, Daml Script can do much more than that. It has four different modes of operation:</p>
<ol class="arabic simple">
<li>Run on a special Script Service in the IDE, providing the Script Views.</li>
<li>Run the Script Service via the CLI, which is useful for quick regression testing.</li>
<li>Start a Sandbox and run against that for regression testing against an actual Ledger API.</li>
<li>Run against any other already running Ledger.</li>
</ol>
</div></blockquote>
<p><a class="reference internal" href="../../tools/navigator/index.html"><span class="doc">Daml Navigator</span></a></p>
<blockquote>
<div>Daml Navigator is a UI that runs against a Ledger API and allows interaction with contracts.</div></blockquote>
<p><a class="reference internal" href="../../daml-repl/index.html"><span class="doc">Daml REPL</span></a></p>
<blockquote>
<div>If you want to do things interactively, Daml REPL is the tool to use. The best way to think of Daml REPL is as an interactive version of Daml Script, but it doubles up as a language REPL (Read-Evaluate-Print Loop), allowing you to evaluate pure expressions and inspect the results.</div></blockquote>
</div>
<div class="section" id="debug-trace-and-stacktraces">
<h2>Debug, Trace, and Stacktraces<a class="headerlink" href="#debug-trace-and-stacktraces" title="Permalink to this heading">¶</a></h2>
<p>The above demonstrates nicely how to test the happy path, but what if a function doesn’t behave as you expected? Daml has two functions that allow you to do fine-grained printf debugging: <code class="docutils literal notranslate"><span class="pre">debug</span></code> and <code class="docutils literal notranslate"><span class="pre">trace</span></code>. Both allow you to print something to StdOut if the code is reached. The difference between <code class="docutils literal notranslate"><span class="pre">debug</span></code> and <code class="docutils literal notranslate"><span class="pre">trace</span></code> is similar to the relationship between <code class="docutils literal notranslate"><span class="pre">abort</span></code> and <code class="docutils literal notranslate"><span class="pre">error</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">debug</span> <span class="pre">:</span> <span class="pre">Text</span> <span class="pre">-&gt;</span> <span class="pre">m</span> <span class="pre">()</span></code> maps a text to an Action that has the side-effect of printing to StdOut.</li>
<li><code class="docutils literal notranslate"><span class="pre">trace</span> <span class="pre">:</span> <span class="pre">Text</span> <span class="pre">-&gt;</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">a</span></code> prints to StdOut when the expression is evaluated.</li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>daml&gt; let a : Script () = debug &quot;foo&quot;
daml&gt; let b : Script () = trace &quot;bar&quot; (debug &quot;baz&quot;)
[Daml.Script:378]: &quot;bar&quot;
daml&gt; a
[DA.Internal.Prelude:532]: &quot;foo&quot;
daml&gt; b
[DA.Internal.Prelude:532]: &quot;baz&quot;
daml&gt;
</pre></div>
</div>
<p>If in doubt, use <code class="docutils literal notranslate"><span class="pre">debug</span></code>. It’s the easier of the two to interpret the results of.</p>
<p>The thing in the square brackets is the last location. It’ll tell you the Daml file and line number that triggered the printing, but often no more than that because full stacktraces could violate subtransaction privacy quite easily. If you want to enable stacktraces for some purely functional code in your modules, you can use the machinery in <a class="reference internal" href="../stdlib/DA-Stack.html"><span class="doc">DA.Stack</span></a> to do so, but we won’t cover that any further here.</p>
</div>
<div class="section" id="diagnose-contention-errors">
<h2>Diagnose Contention Errors<a class="headerlink" href="#diagnose-contention-errors" title="Permalink to this heading">¶</a></h2>
<p>The above tools and functions allow you to diagnose most problems with Daml code, but they are all synchronous. The sequence of commands is determined by the sequence of inputs. That means one of the main pitfalls of distributed applications doesn’t come into play: Contention.</p>
<p>Contention refers to conflicts over access to contracts. Daml guarantees that there can only be one consuming choice exercised per contract so what if two parties simultaneously submit an exercise command on the same contract? Only one can succeed. Contention can also occur due to incomplete or stale knowledge. Maybe a contract was archived a little while ago, but due to latencies, a client hasn’t found out yet, or maybe due to the privacy model, they never will. What all these cases have in common is that someone has incomplete knowledge of the state the ledger will be in at the time a transaction will be processed and/or committed.</p>
<p>If we look back at <a class="reference internal" href="7_Composing.html#execution-model"><span class="std std-ref">Daml’s Execution Model</span></a> we’ll see there are three places where ledger state is consumed:</p>
<ol class="arabic simple">
<li>A command is submitted by some client, probably looking at the state of the ledger to build that command. Maybe the command includes references to ContractIds that the client believes are active.</li>
<li>During interpretation, ledger state is used to look up active contracts.</li>
<li>During commit, ledger state is again used to look up contracts and validate the transaction by reinterpreting it.</li>
</ol>
<p>Collisions can occur both between 1 and 2 and between 2 and 3. Only during the commit phase is the complete relevant ledger state at the time of the transaction known, which means the ledger state at commit time is king. As a Daml contract developer, you need to understand the different causes of contention, be able to diagnose the root cause if errors of this type occur, and be able to avoid collisions by designing contracts appropriately.</p>
<div class="section" id="common-errors">
<h3>Common Errors<a class="headerlink" href="#common-errors" title="Permalink to this heading">¶</a></h3>
<p>The most common error messages you’ll see are listed below. All of them can be due to one of three reasons.</p>
<ol class="arabic simple">
<li>Race Conditions - knowledge of a state change is not yet known during command submission</li>
<li>Stale References - the state change is known, but contracts have stale references to keys or ContractIds</li>
<li>Ignorance - due to privacy or operational semantics, the requester doesn’t know the current state</li>
</ol>
<p>Following the possible error messages, we’ll discuss a few possible causes and remedies.</p>
<div class="section" id="contractid-not-found-during-interpretation">
<h4>ContractId Not Found During Interpretation<a class="headerlink" href="#contractid-not-found-during-interpretation" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Command interpretation error in LF-Damle: dependency error: couldn&#39;t find contract ContractId(004481eb78464f1ed3291b06504d5619db4f110df71cb5764717e1c4d3aa096b9f).
</pre></div>
</div>
</div>
<div class="section" id="contractid-not-found-during-validation">
<h4>ContractId Not Found During Validation<a class="headerlink" href="#contractid-not-found-during-validation" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Disputed: dependency error: couldn&#39;t find contract ContractId (00c06fa370f8858b20fd100423d928b1d200d8e3c9975600b9c038307ed6e25d6f).
</pre></div>
</div>
</div>
<div class="section" id="fetchbykey-error-during-interpretation">
<h4>fetchByKey Error During Interpretation<a class="headerlink" href="#fetchbykey-error-during-interpretation" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Command interpretation error in LF-Damle: dependency error: couldn&#39;t find key com.daml.lf.transaction.GlobalKey@11f4913d.
</pre></div>
</div>
</div>
<div class="section" id="fetchbykey-dispute-during-validation">
<h4>fetchByKey Dispute During Validation<a class="headerlink" href="#fetchbykey-dispute-during-validation" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Disputed: dependency error: couldn&#39;t find key com.daml.lf.transaction.GlobalKey@11f4913d
</pre></div>
</div>
</div>
<div class="section" id="lookupbykey-dispute-during-validation">
<h4>lookupByKey Dispute During Validation<a class="headerlink" href="#lookupbykey-dispute-during-validation" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Disputed: recreated and original transaction mismatch VersionedTransaction(...) expected, but VersionedTransaction(...) is recreated.
</pre></div>
</div>
</div>
</div>
<div class="section" id="avoid-race-conditions-and-stale-references">
<h3>Avoid Race Conditions and Stale References<a class="headerlink" href="#avoid-race-conditions-and-stale-references" title="Permalink to this heading">¶</a></h3>
<p>The first thing to avoid is write-write or write-read contention on contracts. In other words, one requester submitting a transaction with a consuming exercise on a contract while another requester submits another exercise or fetch on the same contract. This type of contention cannot be eliminated entirely, for there will always be some latency between a client submitting a command to a participant, and other clients learning of the committed transaction.</p>
<p>Here are a few scenarios and measures you can take to reduce this type of collision:</p>
<ol class="arabic">
<li><p class="first">Shard data. Imagine you want to store a user directory on the Ledger. At the core, this is of type <code class="docutils literal notranslate"><span class="pre">[(Text,</span> <span class="pre">Party)]</span></code>, where <code class="docutils literal notranslate"><span class="pre">Text</span></code> is a display name and <cite>Party</cite> the associated Party. If you store this entire list on a single contract, any two users wanting to update their display name at the same time will cause a collision. If you instead keep each <code class="docutils literal notranslate"><span class="pre">(Text,</span> <span class="pre">Party)</span></code> on a separate contract, these write operations become independent from each other.</p>
<p>The Analogy to keep in mind when structuring your data is that a template defines a table, and a contract is a row in that table. Keeping large pieces of data on a contract is like storing big blobs in a database row. If these blobs can change through different actions, you get write conflicts.</p>
</li>
<li><p class="first">Use nonconsuming choices if you can. Nonconsuming exercises have the same contention properties as fetches: they don’t collide with each other.</p>
<p>Contract keys can seem like a way out, but they are not. Contract keys are resolved to Contract IDs during the interpretation phase on the participant node. So it reduces latencies slightly by moving resolution from the client layer to the participant layer, but it doesn’t remove the issue. Going back to the auction example above, if Alice sent a command <code class="docutils literal notranslate"><span class="pre">exerciseByKey</span> <span class="pre">&#64;Auction</span> <span class="pre">auctionKey</span> <span class="pre">Bid</span> <span class="pre">with</span> <span class="pre">amount</span> <span class="pre">=</span> <span class="pre">100</span></code>, this would be resolved to an <code class="docutils literal notranslate"><span class="pre">exercise</span> <span class="pre">cid</span> <span class="pre">Bid</span> <span class="pre">with</span> <span class="pre">amount</span> <span class="pre">=</span> <span class="pre">100</span></code> during interpretation, where <code class="docutils literal notranslate"><span class="pre">cid</span></code> is the participant’s best guess what ContractId the key refers to.</p>
</li>
<li><p class="first">Avoid workflows that encourage multiple parties to simultaneously try to exercise a consuming choice on the same contract. For example, imagine an <code class="docutils literal notranslate"><span class="pre">Auction</span></code> contract containing a field <code class="docutils literal notranslate"><span class="pre">highestBid</span> <span class="pre">:</span> <span class="pre">(Party,</span> <span class="pre">Decimal)</span></code>. If Alice tries to bid $100 at the same time that Bob tries to bid $90, it doesn’t matter that Alice’s bid is higher. The second transaction to be sequenced will be rejected as it has a write collision with the first. It’s better to record the bids in separate <code class="docutils literal notranslate"><span class="pre">Bid</span></code> contracts, which can be written to independently. Again, think about how you would structure this data in a relational database to avoid data loss due to race conditions.</p>
</li>
<li><p class="first">Think carefully about storing ContractIds. Imagine you had created a sharded user directory according to 1. Each user has a <code class="docutils literal notranslate"><span class="pre">User</span></code> contract that store their display name and party. Now you write a chat application where each <code class="docutils literal notranslate"><span class="pre">Message</span></code> contract refers to the sender by <code class="docutils literal notranslate"><span class="pre">ContractId</span> <span class="pre">User</span></code>. If the user changes their display name, that reference goes stale. You either have to modify all messages that user ever sent, or become unable to use the sender contract in Daml. If you need to be able to make this link inside Daml, Contract Keys help here. If the only place you need to link <code class="docutils literal notranslate"><span class="pre">Party</span></code> to <code class="docutils literal notranslate"><span class="pre">User</span></code> is the UI, it might be best to not store contract references in Daml at all.</p>
</li>
</ol>
</div>
<div class="section" id="collisions-due-to-ignorance">
<h3>Collisions Due to Ignorance<a class="headerlink" href="#collisions-due-to-ignorance" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../../concepts/ledger-model/index.html"><span class="doc">Daml Ledger Model</span></a> specifies authorization rules, and privacy rules. Ie it specifies what makes a transaction conformant, and who gets to see which parts of a committed transaction. It does <em>not</em> specify how a command is translated to a transaction. This may seem strange at first since the commands - create, exercise, exerciseByKey, createAndExercise - correspond so closely to actions in the ledger model. But the subtlety comes in on the read side. What happens when the participant, during interpretation, encounters a <code class="docutils literal notranslate"><span class="pre">fetch</span></code>, <code class="docutils literal notranslate"><span class="pre">fetchByKey</span></code>, or <code class="docutils literal notranslate"><span class="pre">lookupByKey</span></code>?</p>
<p>To illustrate the problem, let’s assume there is a template <code class="docutils literal notranslate"><span class="pre">T</span></code> with a contract key, and Alice has witnessed two <code class="docutils literal notranslate"><span class="pre">Create</span></code> nodes of a contract of type <code class="docutils literal notranslate"><span class="pre">T</span></code> with key <code class="docutils literal notranslate"><span class="pre">k</span></code>, but no corresponding archive nodes. Alice may not be able to order these two nodes causally in the sense of “one create came before the other”. See <a class="reference internal" href="../../concepts/local-ledger.html"><span class="doc">Causality and Local Daml Ledgers</span></a> for an in-depth treatment of causality on Daml Ledgers.</p>
<p>So what should happen now if Alice’s participant encounters a <code class="docutils literal notranslate"><span class="pre">fetchByKey</span> <span class="pre">&#64;T</span> <span class="pre">k</span></code> or <code class="docutils literal notranslate"><span class="pre">lookupByKey</span> <span class="pre">&#64;T</span> <span class="pre">k</span></code> during interpretation? What if it encounters a <code class="docutils literal notranslate"><span class="pre">fetch</span></code> node? These decisions are part of the operational semantics, and the decision of what should happen is based on the consideration that the chance of a participant submitting an invalid transaction should be minimized.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">fetch</span></code> or <code class="docutils literal notranslate"><span class="pre">exercise</span></code> is encountered, the participant resolves the contract as long as it has not witnessed an archive node for that contract - ie as long as it can’t guarantee that the contract is no longer active. The rationale behind this is that <code class="docutils literal notranslate"><span class="pre">fetch</span></code> and <code class="docutils literal notranslate"><span class="pre">exercise</span></code> use ContractIds, which need to come from somewhere: Command arguments, Contract arguments, or key lookups. In all three cases, someone believes the ContractId to be active still so it’s worth trying.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">fetchByKey</span></code> or <code class="docutils literal notranslate"><span class="pre">lookupByKey</span></code> node is encountered, the contract is only resolved if the requester is a stakeholder on an active contract with the given key. If that’s not the case, there is no reason to believe that the key still resolves to some contract that was witnessed earlier. Thus, when using contract keys, make sure you make the likely requesters of transactions observers on your contracts. If you don’t, <code class="docutils literal notranslate"><span class="pre">fetchByKey</span></code> will always fail, and <code class="docutils literal notranslate"><span class="pre">lookupByKey</span></code> will always return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Let’s illustrate how collisions and operational semantics and interleave:</p>
<ol class="arabic simple">
<li>Bob creates <code class="docutils literal notranslate"><span class="pre">T</span></code> with key <code class="docutils literal notranslate"><span class="pre">k</span></code>. Alice is not a stakeholder.</li>
<li>Alice submits a command resulting in well-authorized <code class="docutils literal notranslate"><span class="pre">lookupByKey</span> <span class="pre">&#64;T</span> <span class="pre">k</span></code> during interpretation. Even if Alice witnessed 1, this will resolve to a <code class="docutils literal notranslate"><span class="pre">None</span></code> as Alice is not a stakeholder. This transaction is invalid at the time of interpretation, but Alice doesn’t know that.</li>
<li>Bob submits an <code class="docutils literal notranslate"><span class="pre">exerciseByKey</span> <span class="pre">&#64;T</span> <span class="pre">k</span> <span class="pre">Archive</span></code>.</li>
<li>Depending on which of the transactions from 2 and 3 gets sequenced first, either just 3, or both 2 and 3 get committed. If 3 is committed before 2, 2 becomes valid while in transit.</li>
</ol>
<p>As you can see, the behavior of <code class="docutils literal notranslate"><span class="pre">fetch</span></code>, <code class="docutils literal notranslate"><span class="pre">fetchByKey</span></code> and <code class="docutils literal notranslate"><span class="pre">lookupByKey</span></code> at interpretation time depend on what information is available to the requester at that time. That’s something to keep in mind when writing Daml contracts, and something to think about when encountering frequent “Disputed” errors.</p>
</div>
</div>
<div class="section" id="checking-coverage">
<h2>Checking Coverage<a class="headerlink" href="#checking-coverage" title="Permalink to this heading">¶</a></h2>
<p>When <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span></code> runs, it analyzes the ledger record to produce a report on what percentage of templates were created and which interface and template choices were exercised during our tests.</p>
<div class="section" id="flags-controlling-tests-and-coverage">
<h3>Flags Controlling Tests and Coverage<a class="headerlink" href="#flags-controlling-tests-and-coverage" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span></code> has four important options which affect the coverage report: <code class="docutils literal notranslate"><span class="pre">--test-pattern</span> <span class="pre">PATTERN</span></code>, <code class="docutils literal notranslate"><span class="pre">--files</span> <span class="pre">FILE</span></code>, <code class="docutils literal notranslate"><span class="pre">--show-coverage</span></code>, and <code class="docutils literal notranslate"><span class="pre">--all</span></code>:</p>
<p>Enabling <code class="docutils literal notranslate"><span class="pre">--show-coverage</span></code> lists by name any templates, choices, and interfaces which are not covered. By default, the report only reports percentage of coverage.</p>
<p>The remaining three options affect which tests are run. The coverage report is in aggregate for all tests run - tests that don’t run do not count towards coverage.</p>
<ul class="simple">
<li>Passing <code class="docutils literal notranslate"><span class="pre">--test-pattern</span> <span class="pre">&lt;PATTERN&gt;</span></code> runs only the local tests which match <code class="docutils literal notranslate"><span class="pre">PATTERN</span></code>.</li>
<li>Passing <code class="docutils literal notranslate"><span class="pre">--files</span> <span class="pre">&lt;FILE&gt;</span></code> runs only the tests found in <code class="docutils literal notranslate"><span class="pre">FILE</span></code>.</li>
<li>Enabling <code class="docutils literal notranslate"><span class="pre">--all</span></code> runs tests in dependency modules as well. Note: it is not affected by <code class="docutils literal notranslate"><span class="pre">test-pattern</span></code> - all external tests are run, and <code class="docutils literal notranslate"><span class="pre">test-pattern</span></code> only restricts local tests.</li>
</ul>
</div>
<div class="section" id="define-templates-choices-and-interfaces">
<h3>Define templates, choices, and interfaces<a class="headerlink" href="#define-templates-choices-and-interfaces" title="Permalink to this heading">¶</a></h3>
<p>To demonstrate how the coverage report works, we start by defining three dummy templates, <code class="docutils literal notranslate"><span class="pre">T1</span></code>, <code class="docutils literal notranslate"><span class="pre">T2</span></code>, and <code class="docutils literal notranslate"><span class="pre">T3</span></code>. Each template has two dummy choices:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Create three dummy tokens with two dummy choices each</span><span class="w"></span>
<span class="kr">template</span><span class="w"> </span><span class="kt">T1</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">signatory</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T1_1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T1_2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="kr">template</span><span class="w"> </span><span class="kt">T2</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">signatory</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T2_1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T2_2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="kr">template</span><span class="w"> </span><span class="kt">T3</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">signatory</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T3_1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_T3_2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
</pre></div>
</div>
<p>We also define an interface <code class="docutils literal notranslate"><span class="pre">I</span></code> with instances for <code class="docutils literal notranslate"><span class="pre">T1</span></code> and <code class="docutils literal notranslate"><span class="pre">T2</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Create dummy interface with two dummy choices, implement over T1 and T2, and an unused empty view</span><span class="w"></span>
<span class="kr">data</span><span class="w"> </span><span class="kt">IView</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="kr">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">viewtype</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">  </span><span class="n">getController</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_I_1</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="p">(</span><span class="n">getController</span><span class="w"> </span><span class="kr">this</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">C_I_2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="p">(</span><span class="n">getController</span><span class="w"> </span><span class="kr">this</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">interface</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="kt">T1</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">    </span><span class="n">getController</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">interface</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="kt">T2</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">    </span><span class="n">getController</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="start-testing">
<h3>Start testing<a class="headerlink" href="#start-testing" title="Permalink to this heading">¶</a></h3>
<p>By writing a test which selectively creates and exercises only some of these templates and choices, we will see how the coverage report shows us templates and choices we haven’t created and exercised respectively.</p>
<p>To start, the test allocates a single party, <code class="docutils literal notranslate"><span class="pre">alice</span></code>, which we will use for the whole test:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">  </span><span class="c1">-- Allocate a party</span><span class="w"></span>
<span class="w">  </span><span class="n">alice</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">allocateParty</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="template-creation-coverage">
<h3>Template creation coverage<a class="headerlink" href="#template-creation-coverage" title="Permalink to this heading">¶</a></h3>
<p>The coverage report mentions which templates were defined but never created. For example, the following test creates contracts out of only <code class="docutils literal notranslate"><span class="pre">T1</span></code> and <code class="docutils literal notranslate"><span class="pre">T2</span></code>, never creating instances of template <code class="docutils literal notranslate"><span class="pre">T3</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">-- Create contracts out of templates T1 and T2</span><span class="w"></span>
<span class="w">  </span><span class="n">t1</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">createCmd</span><span class="w"> </span><span class="kt">T1</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">t2</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">createCmd</span><span class="w"> </span><span class="kt">T2</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">--show-coverage</span></code> reports how many templates were defined (3), how many were created (2, 66.7%), and the names of those that weren’t created (<code class="docutils literal notranslate"><span class="pre">T3</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">daml</span> <span class="n">test</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">coverage</span>
<span class="o">...</span>
<span class="n">Modules</span> <span class="n">internal</span> <span class="n">to</span> <span class="n">this</span> <span class="n">package</span><span class="p">:</span>
<span class="o">-</span> <span class="n">Internal</span> <span class="n">templates</span>
  <span class="mi">3</span> <span class="n">defined</span>
  <span class="mi">2</span> <span class="p">(</span> <span class="mf">66.7</span><span class="o">%</span><span class="p">)</span> <span class="n">created</span>
  <span class="n">internal</span> <span class="n">templates</span> <span class="n">never</span> <span class="n">created</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T3</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="template-choice-exercise-coverage">
<h3>Template choice exercise coverage<a class="headerlink" href="#template-choice-exercise-coverage" title="Permalink to this heading">¶</a></h3>
<p>The coverage report also tracks which choices were exercised. For example, the following test exercises the first and second choices of <code class="docutils literal notranslate"><span class="pre">T1</span></code> and the second choice of <code class="docutils literal notranslate"><span class="pre">T2</span></code>. It also archives <code class="docutils literal notranslate"><span class="pre">T1</span></code>, but not <code class="docutils literal notranslate"><span class="pre">T2</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">-- Exercise all choices &amp; archive t1</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="kt">C_T1_1</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="kt">C_T1_2</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">archiveCmd</span><span class="w"> </span><span class="n">t1</span><span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="c1">-- Exercise only first choice on t2, don&#39;t archive</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="kt">C_T2_1</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">--show-coverage</span></code> reports that the test exercised 4 out of 9 choices, and lists the choices that weren’t exercised, including the second choice of <code class="docutils literal notranslate"><span class="pre">T2</span></code> and all the choices on <code class="docutils literal notranslate"><span class="pre">T3</span></code>.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">Token_Coverage_Part1:T2:Archive</span></code> is included in the list of unexercised choices - because <code class="docutils literal notranslate"><span class="pre">t2</span></code> was not archived, its <code class="docutils literal notranslate"><span class="pre">Archive</span></code> choice was not run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">daml</span> <span class="n">test</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">coverage</span>
<span class="o">...</span>
<span class="o">-</span> <span class="n">Internal</span> <span class="n">template</span> <span class="n">choices</span>
<span class="mi">9</span> <span class="n">defined</span>
<span class="mi">4</span> <span class="p">(</span> <span class="mf">44.4</span><span class="o">%</span><span class="p">)</span> <span class="n">exercised</span>
<span class="n">internal</span> <span class="n">template</span> <span class="n">choices</span> <span class="n">never</span> <span class="n">exercised</span><span class="p">:</span> <span class="mi">5</span>
  <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T2</span><span class="p">:</span><span class="n">Archive</span>
  <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T2</span><span class="p">:</span><span class="n">C_T2_2</span>
  <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T3</span><span class="p">:</span><span class="n">Archive</span>
  <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T3</span><span class="p">:</span><span class="n">C_T3_1</span>
  <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T3</span><span class="p">:</span><span class="n">C_T3_2</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="interface-choice-exercise-coverage">
<h3>Interface choice exercise coverage<a class="headerlink" href="#interface-choice-exercise-coverage" title="Permalink to this heading">¶</a></h3>
<p>The coverage report also tracks interfaces, with two differences:
* Because interfaces are not created directly but rather cast from templates which implement them, the coverage report cannot not track their creation nor their archival.
* Because interfaces can be cast from many possible implementing templates, the report tracks interface choices by what interface they are exercised on and which template they were cast from. In the report, these interface choices are formatted as <code class="docutils literal notranslate"><span class="pre">&lt;module&gt;:&lt;template&gt;:&lt;choice_name&gt;</span></code> - the <code class="docutils literal notranslate"><span class="pre">&lt;choice_name&gt;</span></code> tells us the interface, the <code class="docutils literal notranslate"><span class="pre">&lt;template&gt;</span></code> tells us the template type an interface contract was cast from.</p>
<p>The following test creates <code class="docutils literal notranslate"><span class="pre">t1</span></code> and <code class="docutils literal notranslate"><span class="pre">t2</span></code> as before, but casts them immediately to <code class="docutils literal notranslate"><span class="pre">I</span></code> to get two contracts of <code class="docutils literal notranslate"><span class="pre">I</span></code>: <code class="docutils literal notranslate"><span class="pre">t1_i</span></code> via <code class="docutils literal notranslate"><span class="pre">T1</span></code>, and <code class="docutils literal notranslate"><span class="pre">t2_i</span></code> via <code class="docutils literal notranslate"><span class="pre">T2</span></code>. It exercises both choices on the <code class="docutils literal notranslate"><span class="pre">t1_i</span></code>, but only the first choice on <code class="docutils literal notranslate"><span class="pre">t2_i</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">-- Exercise all choices on t1_i</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t1_i</span><span class="w"> </span><span class="kt">C_I_1</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t1_i</span><span class="w"> </span><span class="kt">C_I_2</span><span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="c1">-- Exercise only first choice on t2_i</span><span class="w"></span>
<span class="w">  </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">t2_i</span><span class="w"> </span><span class="kt">C_I_1</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>In the coverage report, there are four detected choices, as expected: two choices for the implementation of <code class="docutils literal notranslate"><span class="pre">I</span></code> for <code class="docutils literal notranslate"><span class="pre">T1</span></code>, and two choices for the implementation of <code class="docutils literal notranslate"><span class="pre">I</span></code> for <code class="docutils literal notranslate"><span class="pre">T2</span></code>. Three were exercised, so the only choice that wasn’t exercised was <code class="docutils literal notranslate"><span class="pre">C_I_1</span></code> for <code class="docutils literal notranslate"><span class="pre">T2</span></code>, which is reported as <code class="docutils literal notranslate"><span class="pre">Token_Coverage_Part1:T2:C_I_1</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">daml</span> <span class="n">test</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">coverage</span>
<span class="o">...</span>
<span class="o">-</span> <span class="n">Internal</span> <span class="n">interface</span> <span class="n">choices</span>
  <span class="mi">4</span> <span class="n">defined</span>
  <span class="mi">3</span> <span class="p">(</span> <span class="mf">75.0</span><span class="o">%</span><span class="p">)</span> <span class="n">exercised</span>
  <span class="n">internal</span> <span class="n">interface</span> <span class="n">choices</span> <span class="n">never</span> <span class="n">exercised</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">Token_Coverage_Part1</span><span class="p">:</span><span class="n">T2</span><span class="p">:</span><span class="n">C_I_2</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-coverage-of-external-dependencies">
<h2>Checking Coverage of External Dependencies<a class="headerlink" href="#checking-coverage-of-external-dependencies" title="Permalink to this heading">¶</a></h2>
<p>The coverage report also describes coverage for external templates, interfaces, and choices. In the <code class="docutils literal notranslate"><span class="pre">intro12-part1</span></code> directory, run <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">build</span> <span class="pre">--output</span> <span class="pre">intro12-part1.dar</span></code>, and copy the resulting <code class="docutils literal notranslate"><span class="pre">./intro12-part1.dar</span></code> file into the <code class="docutils literal notranslate"><span class="pre">intro12-part2</span></code> directory, where the remainder of our commands will be run.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code> configuration file in part2 specifies <code class="docutils literal notranslate"><span class="pre">intro12-part1.dar</span></code> as a dependency, letting us import its module.</p>
<div class="section" id="definitions">
<h3>Definitions<a class="headerlink" href="#definitions" title="Permalink to this heading">¶</a></h3>
<p>We begin by defining importing the external dependency <code class="docutils literal notranslate"><span class="pre">Token_Coverage_Part1</span></code> as <code class="docutils literal notranslate"><span class="pre">External</span></code> to bring all of its external templates and interfaces into scope.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Token_Coverage_Part1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">External</span><span class="w"></span>
</pre></div>
</div>
<p>We also define a dummy template <code class="docutils literal notranslate"><span class="pre">T</span></code> with no choices, but an implementation of external interface <code class="docutils literal notranslate"><span class="pre">External.I</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">signatory</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">interface</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">I</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">IView</span><span class="w"></span>
<span class="w">    </span><span class="n">getController</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
</pre></div>
</div>
<p>Finally, we define an interface <code class="docutils literal notranslate"><span class="pre">I</span></code> with one dummy choice, and implementations for our local template <code class="docutils literal notranslate"><span class="pre">T</span></code> and the external template <code class="docutils literal notranslate"><span class="pre">External.T1</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">IView</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="kr">interface</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="kr">viewtype</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">  </span><span class="n">getController</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Party</span><span class="w"></span>

<span class="w">  </span><span class="kr">nonconsuming</span><span class="w"> </span><span class="kr">choice</span><span class="w"> </span><span class="kt">I_C</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="w">    </span><span class="kr">controller</span><span class="w"> </span><span class="p">(</span><span class="n">getController</span><span class="w"> </span><span class="kr">this</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kr">do</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>

<span class="w">  </span><span class="kr">interface</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">    </span><span class="n">getController</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>

<span class="w">  </span><span class="kr">interface</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">I</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">T1</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">view</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">IView</span><span class="w"></span>
<span class="w">    </span><span class="n">getController</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="local-definitions">
<h3>Local Definitions<a class="headerlink" href="#local-definitions" title="Permalink to this heading">¶</a></h3>
<p>Running <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">-p</span> <span class="pre">'/^$/'</span></code> to create a coverage report without running any tests - because no tests were run, coverage will be 0% in all cases, but the report will still tally all discovered templates, interfaces, and choices, both external and internal.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Modules internal to this package:
- Internal templates
  1 defined
  0 (  0.0%) created
- Internal template choices
  1 defined
  0 (  0.0%) exercised
- Internal interface implementations
  3 defined
    2 internal interfaces
    1 external interfaces
- Internal interface choices
  4 defined
  0 (  0.0%) exercised

Modules external to this package:
- External templates
  3 defined
  0 (  0.0%) created in any tests
  0 (  0.0%) created in internal tests
  0 (  0.0%) created in external tests
- External template choices
  9 defined
  0 (  0.0%) exercised in any tests
  0 (  0.0%) exercised in internal tests
  0 (  0.0%) exercised in external tests
- External interface implementations
  2 defined
- External interface choices
  4 defined
  0 (  0.0%) exercised in any tests
  0 (  0.0%) exercised in internal tests
  0 (  0.0%) exercised in external tests
</pre></div>
</div>
<p>We defined 1 template with 1 default choice (<code class="docutils literal notranslate"><span class="pre">Archive</span></code>), which get reported along with their coverage in the first two sections:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Internal templates
  1 defined
  0 (  0.0%) created
- Internal template choices
  1 defined
  0 (  0.0%) exercised
</pre></div>
</div>
<p>We also have 3 interface implementations that we have defined locally, <code class="docutils literal notranslate"><span class="pre">External.I</span> <span class="pre">for</span> <span class="pre">T</span></code>, <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">for</span> <span class="pre">T</span></code>, and <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">for</span> <span class="pre">External.T1</span></code>. Note that while the interface implementations are local, the interfaces that they are defined over can be non-local - in this case we have 2 for the local interface <code class="docutils literal notranslate"><span class="pre">I</span></code>, and 1 for the external interface <code class="docutils literal notranslate"><span class="pre">External.I</span></code>. The total number of locally defined implementations, and the breakdown into local interfaces and external interfaces, is presented in the “Internal interface implementations” section.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Internal interface implementations
  3 defined
    2 internal interfaces
    1 external interfaces
</pre></div>
</div>
<p>These local interface implementations provide 4 choices, two from <code class="docutils literal notranslate"><span class="pre">External.I</span> <span class="pre">for</span> <span class="pre">T</span></code>, one from <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">for</span> <span class="pre">T</span></code>, and one from <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">for</span> <span class="pre">External.T1</span></code>, reported in the next section along with coverage.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- Internal interface choices
  4 defined
  0 (  0.0%) exercised
</pre></div>
</div>
</div>
<div class="section" id="external-definitions">
<h3>External Definitions<a class="headerlink" href="#external-definitions" title="Permalink to this heading">¶</a></h3>
<p>By importing <code class="docutils literal notranslate"><span class="pre">Token_Coverage_Part1</span></code> as <code class="docutils literal notranslate"><span class="pre">External</span></code>, we have brought 3 templates, 9 template choices, 2 interface instances, and 4 interface choices into scope from there, which are listed in the external modules section.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
Modules external to this package:
- External templates
  3 defined
  ...
- External template choices
  9 defined
  ...
- External interface implementations
  2 defined
- External interface choices
  4 defined
  ...
</pre></div>
</div>
</div>
<div class="section" id="external-internal-and-any-coverage">
<h3>External, Internal, and “Any” Coverage<a class="headerlink" href="#external-internal-and-any-coverage" title="Permalink to this heading">¶</a></h3>
<p>Unlike internal types, externally defined types can be covered by both internal and external tests. As a result, the report for external types distinguishes between coverage provided by internal tests, external tests, and “any” tests (both internal and external tests).</p>
<p>Here we cover how to run internal and external tests simultaneously to get an aggregate report, and how to interpret this report.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--all</span></code> flag runs tests in external modules as well. Run <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">--all</span> <span class="pre">--test-pattern</span> <span class="pre">notests</span></code> in the <code class="docutils literal notranslate"><span class="pre">intro12-part2</span></code> directory - this instructs <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span></code> to run all tests from external modules, and to run local tests matching <code class="docutils literal notranslate"><span class="pre">notests</span></code>. We have no local tests named <code class="docutils literal notranslate"><span class="pre">notests</span></code>, so this will only run the <code class="docutils literal notranslate"><span class="pre">main</span></code> test from <code class="docutils literal notranslate"><span class="pre">part1</span></code>. Because the <code class="docutils literal notranslate"><span class="pre">main</span></code> test from <code class="docutils literal notranslate"><span class="pre">part1</span></code> does not use any of the types defined in <code class="docutils literal notranslate"><span class="pre">part2</span></code>, the internal section of the resulting coverage report shows 0% everywhere. However, the <code class="docutils literal notranslate"><span class="pre">main</span></code> test does exercise many types in <code class="docutils literal notranslate"><span class="pre">part1</span></code> which are external to <code class="docutils literal notranslate"><span class="pre">part2</span></code> - as a result, the report’s “external” section is similar to the “internal” section in the report for <code class="docutils literal notranslate"><span class="pre">part1</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
Modules external to this package:
- External templates
  3 defined
  2 ( 66.7%) created in any tests
  0 (  0.0%) created in internal tests
  2 ( 66.7%) created in external tests
- External template choices
  9 defined
  4 ( 44.4%) exercised in any tests
  0 (  0.0%) exercised in internal tests
  4 ( 44.4%) exercised in external tests
- External interface implementations
  2 defined
- External interface choices
  4 defined
  3 ( 75.0%) exercised in any tests
  0 (  0.0%) exercised in internal tests
  3 ( 75.0%) exercised in external tests
</pre></div>
</div>
<p>Note that unlike the internal section of the report in Part 1, the external section of the report in Part 2 has coverage for internal tests, external tests, and any tests. In this report, we only ran an external test, <code class="docutils literal notranslate"><span class="pre">External:main</span></code>, so 0 is reported for all internal tests.</p>
<p>Let’s write a local test which will create <code class="docutils literal notranslate"><span class="pre">External:T3</span></code>, a template which the <code class="docutils literal notranslate"><span class="pre">External:main</span></code> test does not create.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">testT3</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Script</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="nf">testT3</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">  </span><span class="n">alice</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">allocateParty</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w"></span>
<span class="w">  </span><span class="n">external_t3</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">createCmd</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">T3</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
</pre></div>
</div>
<p>If we run this test on its own using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">--test-pattern</span> <span class="pre">testT3</span></code>, our external coverage report will show that 1 out of 3 of the external templates in scope were created, 1 by internal tests and 0 by external tests.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
modules external to this package:
- external templates
  3 defined
  1 ( 33.3%) created in any tests
  1 ( 33.3%) created in internal tests
  0 (  0.0%) created in external tests
...
</pre></div>
</div>
<p>We can run this test alongside the <code class="docutils literal notranslate"><span class="pre">External:main</span></code> test using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">test</span> <span class="pre">--all</span> <span class="pre">--test-pattern</span> <span class="pre">testT3</span></code>, to get an aggregate coverage report. The report now shows that 2 out of 3 of the external templates in scope were created in <code class="docutils literal notranslate"><span class="pre">External:main</span></code>, and 1 out of 3 by internal test <code class="docutils literal notranslate"><span class="pre">testT3</span></code>. Because <code class="docutils literal notranslate"><span class="pre">External:main</span></code> creates <code class="docutils literal notranslate"><span class="pre">External:T1</span></code> and <code class="docutils literal notranslate"><span class="pre">External:T2</span></code>, and <code class="docutils literal notranslate"><span class="pre">testT3</span></code> creates <code class="docutils literal notranslate"><span class="pre">External:T3</span></code>, all types are created across our tests, and the overall coverage across any tests is 3 out of 3 (100%).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
Modules external to this package:
- External templates
  3 defined
  3 (100.0%) created in any tests
  1 ( 33.3%) created in internal tests
  2 ( 66.7%) created in external tests
...
</pre></div>
</div>
<p>If we define a different local test, <code class="docutils literal notranslate"><span class="pre">testT1AndT2</span></code>, which creates <code class="docutils literal notranslate"><span class="pre">T1</span></code> and <code class="docutils literal notranslate"><span class="pre">T2</span></code>, running it alongside <code class="docutils literal notranslate"><span class="pre">External:Main</span></code>, our report shows 2 out of 3 for “internal tests”, 2 out of 3 for “external tests”, but 2 out of 3 for “any tests”! Because the templates created by each test overlap, <code class="docutils literal notranslate"><span class="pre">T3</span></code> is never created and never covered, so despite an abundance of testing for external templates, coverage is still less than 100%.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">testT1AndT2</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="kt">Script</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="nf">testT1AndT2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">  </span><span class="n">alice</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">allocateParty</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w"></span>
<span class="w">  </span><span class="n">external_t1</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">createCmd</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">T1</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">external_t2</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="p">(</span><span class="n">createCmd</span><span class="w"> </span><span class="kt">External</span><span class="o">.</span><span class="kt">T2</span><span class="w"> </span><span class="kr">with</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
Modules external to this package:
- External templates
  3 defined
  2 ( 66.7%) created in any tests
  2 ( 66.7%) created in internal tests
  2 ( 66.7%) created in external tests
...
</pre></div>
</div>
<p>External template choices and interface instance choices are also reported with “any”, internal, and external coverage - we will not cover them here.</p>
</div>
</div>
<div class="section" id="next-up">
<h2>Next Up<a class="headerlink" href="#next-up" title="Permalink to this heading">¶</a></h2>
<p>There’s little more to learn about writing Daml at this point that isn’t best learned by practice and consulting reference material for both Daml and Haskell. In section 13, <a class="reference internal" href="13_Interfaces.html"><span class="doc">Interfaces</span></a> we will cover the use of interfaces, a feature which aids code reuse across your Daml programs.</p>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="8_Exceptions.html" class="da-btn da-btn-label btn-prev" title="Exception Handling" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="5_Restrictions.html" class="da-btn da-btn-label btn-next" title="Add Constraints to a Contract" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>