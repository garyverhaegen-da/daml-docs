<!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Daml Triggers - Off-Ledger Automation in Daml &mdash; Daml SDK 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/language_data.js"></script>
  <script type="text/javascript" src="../_static/clipboard.min.js"></script>
  <script type="text/javascript" src="../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../genindex.html" />
  <link rel="search" title="Search" href="../search.html" />
  <link rel="next" title="Daml Trigger Library" href="api/index.html" />
  <link rel="prev" title="Creating your own bindings" href="../app-dev/bindings-x-lang/index.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->

  
  <!-- Mopinion Pastea.se  start --><script type="text/javascript">(function(){var id="4s6vwov7ad6qyxhq8iwbyhocrsn2nm36k25";var js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("src","//deploy.mopinion.com/js/pastease.js");js.async=true;document.getElementsByTagName("head")[0].appendChild(js);var t=setInterval(function(){try{new Pastease.load(id);clearInterval(t)}catch(e){}},50)})();</script><!-- Mopinion Pastea.se end -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Daml Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/installation.html">Installing the SDK</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/path-variables.html">Setting JAVA_HOME and PATH variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/manual-download.html">Manually installing the SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/index.html">Building Your App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/app-architecture.html">App Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started/first-feature.html">Your First Feature</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.daml.com/cheat-sheet">Cheat Sheet</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../daml/intro/0_Intro.html">An introduction to Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/1_Token.html">1 Basic contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/2_DamlScript.html">2 Testing templates using Daml Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/3_Data.html">3 Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/4_Transformations.html">4 Transforming data using choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/5_Restrictions.html">5 Adding constraints to a contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/6_Parties.html">6 Parties and authority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/7_Composing.html">7 Composing choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/8_Exceptions.html">8 Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/9_Dependencies.html">9 Working with Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/10_Functional101.html">10 Functional Programming 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/11_StdLib.html">11 Intro to the Daml Standard Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/intro/12_Testing.html">12 Testing Daml Contracts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/reference/index.html">Language reference docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/structure.html">Overview: template structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/choices.html">Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/updates.html">Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/data-types.html">Data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/working-with.html">Built-in functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/file-structure.html">File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/packages.html">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/contract-keys.html">Contract keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/reference/exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/stdlib/index.html">The standard library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/Prelude.html">Prelude</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Action.html">DA.Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Action-State.html">DA.Action.State</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Action-State-Class.html">DA.Action.State.Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Assert.html">DA.Assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Bifunctor.html">DA.Bifunctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-BigNumeric.html">DA.BigNumeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Date.html">DA.Date</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Either.html">DA.Either</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Exception.html">DA.Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Foldable.html">DA.Foldable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Functor.html">DA.Functor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-List.html">DA.List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-List-BuiltinOrder.html">DA.List.BuiltinOrder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-List-Total.html">DA.List.Total</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Logic.html">DA.Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Map.html">DA.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Math.html">DA.Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Monoid.html">DA.Monoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Next-Map.html">DA.Next.Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Next-Set.html">DA.Next.Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-NonEmpty.html">DA.NonEmpty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-NonEmpty-Types.html">DA.NonEmpty.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Numeric.html">DA.Numeric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Optional.html">DA.Optional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Optional-Total.html">DA.Optional.Total</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Record.html">DA.Record</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Semigroup.html">DA.Semigroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Set.html">DA.Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Stack.html">DA.Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Text.html">DA.Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-TextMap.html">DA.TextMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Time.html">DA.Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Traversable.html">DA.Traversable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Tuple.html">DA.Tuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/stdlib/DA-Validation.html">DA.Validation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/patterns.html">Good design patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/initaccept.html">Initiate and Accept</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/multiparty-agreement.html">Multiple party agreement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/delegation.html">Delegation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/locking.html">Locking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-archiving.html">Locking by archiving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-state.html">Locking by state</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daml/patterns/locking/locking-by-safekeeping.html">Locking by safekeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../daml/patterns/legends.html">Diagram legends</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Building applications</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../app-dev/app-arch.html">Application architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/bindings-ts/index.html">JavaScript Client Libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml2js.html">JavaScript Code Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-react.html">&#64;daml/react</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-ledger.html">&#64;daml/ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/daml-types.html">&#64;daml/types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-ts/testing.html">Testing Your Web App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../json-api/index.html">HTTP JSON API Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../json-api/lf-value-specification.html">Daml-LF JSON Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json-api/search-query-language.html">Query language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../json-api/metrics.html">Metrics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml-script/index.html">Daml Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../daml-script/api/index.html">Daml Script Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../daml-script/api/Daml-Script.html">Daml.Script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../daml-repl/index.html">Daml REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade/index.html">Upgrading and Extending Daml applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/extend.html">Extending Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade.html">Upgrading Daml applications</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/automation.html">Automating the Upgrade Process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/authorization.html">Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app-dev/ledger-api.html">The Ledger API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/services.html">The Ledger API services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/index.html">gRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/proto-docs.html">Ledger API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/grpc/daml-to-ledger-api.html">How Daml types are translated to protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/daml-lf-translation.html">How Daml types are translated to Daml-LF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-java/index.html">Java bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/codegen.html">Generate Java code from Daml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/example.html">Ping Pong Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../app-dev/bindings-java/quickstart.html">Iou Quickstart Tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-scala/index.html">Scala bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-js.html">Node.js bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app-dev/bindings-x-lang/index.html">Creating your own bindings</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Daml Triggers - Off-Ledger Automation in Daml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/index.html">Daml Trigger Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api/Daml-Trigger.html">Daml.Trigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/Daml-Trigger-Assert.html">Daml.Trigger.Assert</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/Daml-Trigger-LowLevel.html">Daml.Trigger.LowLevel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/trigger-service/index.html">Trigger Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/trigger-service/auth0_example.html">Auth0 Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/auth-middleware/index.html">Auth Middleware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/auth-middleware/oauth2.html">OAuth 2.0 Auth Middleware</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Deploying to Daml ledgers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy/index.html">Overview of Daml ledgers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/generic_ledger.html">Deploying to a generic Daml ledger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy/ledger-topologies.html">Daml Ledger Topologies</a></li>
</ul>
<p class="caption"><span class="caption-text">Operating Daml</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ops/index.html">Daml Participant pruning</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/assistant.html">Daml Assistant (<code class="docutils literal notranslate"><span class="pre">daml</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml/daml-studio.html">Daml Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/sandbox.html">Daml Sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/navigator/index.html">Navigator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/codegen.html">Daml codegen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/profiler.html">Daml Profiler</a></li>
</ul>
<p class="caption"><span class="caption-text">Background concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/glossary.html">Glossary of concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/ledger-model/index.html">Daml Ledger Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-structure.html">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-integrity.html">Integrity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-privacy.html">Privacy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-daml.html">Daml: Defining Contract Models Compactly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts/ledger-model/ledger-exceptions.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/identity-and-package-management.html">Identity and Package Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/time.html">Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/local-ledger.html">Causality and Local Ledgers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://daml.com/examples">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Early Access Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/extractor.html">Extractor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/export/index.html">Ledger Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="../daml-integration-kit/index.html">Daml Integration Kit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/ledger-api-test-tool/index.html">Ledger API Test Tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/visual.html">Visualizing Daml Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/interoperability.html">Ledger Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/non-repudiation.html">Non-repudiation</a></li>
</ul>
<p class="caption"><span class="caption-text">Daml Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support/overview.html">Daml Ecosystem Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../support/status-definitions.html">Status Definitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../support/component-statuses.html">Feature and Component Statuses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support/releases.html">Releases and Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/compatibility.html">Portability, Compatibility, and Support Durations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/support.html">Getting Help</a></li>
</ul>

          
          
          
          <div class="pdf-download"><a href="../_downloads/DigitalAssetSDK.pdf" download>Download as PDF</a></div>
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../_static/images/DAML_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.daml.com/" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Daml Triggers - Off-Ledger Automation in Daml</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#implementing-a-daml-trigger">Implementing a Daml Trigger</a></li>
<li><a class="reference internal" href="#running-a-daml-trigger">Running a Daml Trigger</a></li>
</ul>
</li>
<li><a class="reference internal" href="#when-not-to-use-daml-triggers">When not to use Daml triggers</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="daml-triggers-off-ledger-automation-in-daml">
<h1>Daml Triggers - Off-Ledger Automation in Daml<a class="headerlink" href="#daml-triggers-off-ledger-automation-in-daml" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>In addition to the actual Daml logic which is uploaded to the Ledger
and the UI, Daml applications often need to automate certain
interactions with the ledger. This is commonly done in the form of a
ledger client that listens to the transaction stream of the ledger and
when certain conditions are met, e.g., when a template of a given type
has been created, the client sends commands to the ledger, e.g., it
creates a template of another type.</p>
<p>It is possible to write these clients in a language of your choice,
e.g., JavaScript, using the HTTP JSON API. However, that introduces an
additional layer of friction: You now need to translate between the
template and choice types in Daml and a representation of those Daml
types in the language you are using for your client. Daml triggers
address this problem by allowing you to write certain kinds of
automation directly in Daml reusing all the Daml types and logic that
you have already defined. Note that while the logic for Daml triggers
is written in Daml, they act like any other ledger client: They are
executed separately from the ledger, they do not need to be uploaded
to the ledger and they do not allow you to do anything that any other
ledger client could not do.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Our example for this tutorial consists of 3 templates.</p>
<p>First, we have a template called <code class="docutils literal notranslate"><span class="pre">Original</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span> <span class="kt">Original</span>
  <span class="kr">with</span>
    <span class="n">owner</span> <span class="kt">:</span> <span class="kt">Party</span>
    <span class="n">name</span> <span class="kt">:</span> <span class="kt">Text</span>
    <span class="n">textdata</span> <span class="kt">:</span> <span class="kt">Text</span>
  <span class="kr">where</span>
    <span class="kr">signatory</span> <span class="n">owner</span>

    <span class="n">key</span> <span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kt">Party</span><span class="p">,</span> <span class="kt">Text</span><span class="p">)</span>
    <span class="n">maintainer</span> <span class="n">key</span><span class="o">.</span><span class="n">_1</span>
</pre></div>
</div>
<p>This template has an <code class="docutils literal notranslate"><span class="pre">owner</span></code>, a <code class="docutils literal notranslate"><span class="pre">name</span></code> that identifies it and some
<code class="docutils literal notranslate"><span class="pre">textdata</span></code> that we just represent as <code class="docutils literal notranslate"><span class="pre">Text</span></code> to keep things simple.  We
have also added a contract key to ensure that each owner can only have
one <code class="docutils literal notranslate"><span class="pre">Original</span></code> with a given <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p>Second, we have a template called <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span> <span class="kt">Subscriber</span>
  <span class="kr">with</span>
    <span class="n">subscriber</span> <span class="kt">:</span> <span class="kt">Party</span>
    <span class="n">subscribedTo</span> <span class="kt">:</span> <span class="kt">Party</span>
  <span class="kr">where</span>
    <span class="kr">signatory</span> <span class="n">subscriber</span>
    <span class="kr">observer</span> <span class="n">subscribedTo</span>
    <span class="n">key</span> <span class="p">(</span><span class="n">subscriber</span><span class="p">,</span> <span class="n">subscribedTo</span><span class="p">)</span> <span class="kt">:</span> <span class="p">(</span><span class="kt">Party</span><span class="p">,</span> <span class="kt">Party</span><span class="p">)</span>
    <span class="n">maintainer</span> <span class="n">key</span><span class="o">.</span><span class="n">_1</span>
</pre></div>
</div>
<p>This template allows the <code class="docutils literal notranslate"><span class="pre">subscriber</span></code> to subscribe to <code class="docutils literal notranslate"><span class="pre">Original</span></code> s where <code class="docutils literal notranslate"><span class="pre">subscribedTo</span></code> is the <code class="docutils literal notranslate"><span class="pre">owner</span></code>.
For each of these <code class="docutils literal notranslate"><span class="pre">Original</span></code> s, our Daml trigger should then automatically create an instance of
third template called <code class="docutils literal notranslate"><span class="pre">Copy</span></code>:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">template</span> <span class="kt">Copy</span>
  <span class="kr">with</span>
    <span class="n">original</span> <span class="kt">:</span> <span class="kt">Original</span>
    <span class="n">subscriber</span> <span class="kt">:</span> <span class="kt">Party</span>
  <span class="kr">where</span>
    <span class="kr">signatory</span> <span class="p">(</span><span class="kr">signatory</span> <span class="n">original</span><span class="p">)</span>
    <span class="kr">observer</span> <span class="n">subscriber</span>
</pre></div>
</div>
<p>Our trigger should also ensure that the <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts stay in sync with changes on the ledger. That means
that we need to archive <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts if there is more than one for the same <code class="docutils literal notranslate"><span class="pre">Original</span></code>, we need to archive
<code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts if the corresponding <code class="docutils literal notranslate"><span class="pre">Original</span></code> has been archived and we need to archive
all <code class="docutils literal notranslate"><span class="pre">Copy</span></code> s for a given subscriber if the corresponding <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code> contract has been archived.</p>
<div class="section" id="implementing-a-daml-trigger">
<h3>Implementing a Daml Trigger<a class="headerlink" href="#implementing-a-daml-trigger" title="Permalink to this headline">¶</a></h3>
<p>Having defined what our Daml trigger is supposed to do, we can now
move on to its implementation. A Daml trigger is a regular Daml
project that you can build using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">build</span></code>. To get access to the
API used to build a trigger, you need to add the <code class="docutils literal notranslate"><span class="pre">daml-triggers</span></code>
library to the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> field in <code class="docutils literal notranslate"><span class="pre">daml.yaml</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">prim</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">stdlib</span>
  <span class="o">-</span> <span class="n">daml</span><span class="o">-</span><span class="n">trigger</span>
</pre></div>
</div>
<p>In addition to that you also need to import the <code class="docutils literal notranslate"><span class="pre">Daml.Trigger</span></code>
module.</p>
<p>Daml triggers automatically track the active contract set (ACS), i.e., the set of contracts
that have been created and have not been archived, and the
commands in flight for you. In addition to that, they allow you to
have user-defined state that is updated based on new transactions and
command completions. For our copy trigger, the ACS is sufficient, so
we will simply use <code class="docutils literal notranslate"><span class="pre">()</span></code> as the type of the user defined state.</p>
<p>To create a trigger you need to define a value of type <code class="docutils literal notranslate"><span class="pre">Trigger</span> <span class="pre">s</span></code> where <code class="docutils literal notranslate"><span class="pre">s</span></code> is the type of your user-defined state:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="kr">data</span> <span class="kt">Trigger</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Trigger</span>
  <span class="p">{</span> <span class="n">initialize</span> <span class="kt">:</span> <span class="kt">TriggerInitializeA</span> <span class="n">s</span>
  <span class="p">,</span> <span class="n">updateState</span> <span class="kt">:</span> <span class="kt">Message</span> <span class="ow">-&gt;</span> <span class="kt">TriggerUpdateA</span> <span class="n">s</span> <span class="nb">()</span>
  <span class="p">,</span> <span class="n">rule</span> <span class="kt">:</span> <span class="kt">Party</span> <span class="ow">-&gt;</span> <span class="kt">TriggerA</span> <span class="n">s</span> <span class="nb">()</span>
  <span class="p">,</span> <span class="n">registeredTemplates</span> <span class="kt">:</span> <span class="kt">RegisteredTemplates</span>
  <span class="p">,</span> <span class="n">heartbeat</span> <span class="kt">:</span> <span class="kt">Optional</span> <span class="kt">RelTime</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize</span></code> function is called on startup and allows you to
initialize your user-defined state based on querying the active contract
set.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">updateState</span></code> function is called on new transactions and command
completions and can be used to update your user-defined state based on
the ACS and the transaction or completion. Since our Daml trigger does
not have any interesting user-defined state, we will not go into
details here.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rule</span></code> function is the core of a Daml trigger. It defines which
commands need to be sent to the ledger based on the party the trigger is
executed at, the current state of the ACS, and the user defined state.
The type <code class="docutils literal notranslate"><span class="pre">TriggerA</span></code> allows you to emit commands that are then sent to
the ledger, query the ACS with <code class="docutils literal notranslate"><span class="pre">query</span></code>, update the user-defined state,
as well as retrieve the commands in flight with <code class="docutils literal notranslate"><span class="pre">getCommandsInFlight</span></code>.
Like <code class="docutils literal notranslate"><span class="pre">Scenario</span></code> or <code class="docutils literal notranslate"><span class="pre">Update</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">do</span></code> notation and
<code class="docutils literal notranslate"><span class="pre">getTime</span></code> with <code class="docutils literal notranslate"><span class="pre">TriggerA</span></code>.</p>
<p>We can specify the templates that our trigger will operate
on. In our case, we will simply specify <code class="docutils literal notranslate"><span class="pre">AllInDar</span></code> which means that
the trigger will receive events for all template types defined in the
DAR. It is also possible to specify an explicit list of templates,
e.g., <code class="docutils literal notranslate"><span class="pre">RegisteredTemplates</span> <span class="pre">[registeredTemplate</span> <span class="pre">&#64;Original,</span> <span class="pre">registeredTemplate</span> <span class="pre">&#64;Subscriber,</span> <span class="pre">registeredTemplate</span> <span class="pre">&#64;Copy]</span></code>.
This is mainly useful for performance reasons if your DAR contains many templates that are not relevant for your trigger.</p>
<p>Finally, you can specify an optional heartbeat interval at which the trigger
will be sent a <code class="docutils literal notranslate"><span class="pre">MHeartbeat</span></code> message. This is useful if you want to ensure
that the trigger is executed at a certain rate to issue timed commands.</p>
<p>For our Daml trigger, the definition looks as follows:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">copyTrigger</span> <span class="kt">:</span> <span class="kt">Trigger</span> <span class="nb">()</span>
<span class="nf">copyTrigger</span> <span class="ow">=</span> <span class="kt">Trigger</span>
  <span class="p">{</span> <span class="n">initialize</span> <span class="ow">=</span> <span class="n">pure</span> <span class="nb">()</span>
  <span class="p">,</span> <span class="n">updateState</span> <span class="ow">=</span> <span class="nf">\</span><span class="n">_message</span> <span class="ow">-&gt;</span> <span class="n">pure</span> <span class="nb">()</span>
  <span class="p">,</span> <span class="n">rule</span> <span class="ow">=</span> <span class="n">copyRule</span>
  <span class="p">,</span> <span class="n">registeredTemplates</span> <span class="ow">=</span> <span class="kt">AllInDar</span>
  <span class="p">,</span> <span class="n">heartbeat</span> <span class="ow">=</span> <span class="kt">None</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Now we can move on to the most complex part of our Daml trigger, the implementation of <code class="docutils literal notranslate"><span class="pre">copyRule</span></code>.
First let’s take a look at the signature:</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="nf">copyRule</span> <span class="kt">:</span> <span class="kt">Party</span> <span class="ow">-&gt;</span> <span class="kt">TriggerA</span> <span class="nb">()</span> <span class="nb">()</span>
<span class="nf">copyRule</span> <span class="n">party</span> <span class="ow">=</span> <span class="kr">do</span>
</pre></div>
</div>
<p>We will need the party and the ACS to get the <code class="docutils literal notranslate"><span class="pre">Original</span></code> contracts
where we are the owner, the <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code> contracts where we are in
the <code class="docutils literal notranslate"><span class="pre">subscribedTo</span></code> field and the <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts where we are the
<code class="docutils literal notranslate"><span class="pre">owner</span></code> of the corresponding <code class="docutils literal notranslate"><span class="pre">Original</span></code>.</p>
<p>The commands in flight, retrievable with <code class="docutils literal notranslate"><span class="pre">getCommandsInFlight</span></code>, will
be useful to avoid sending the same command multiple times if
<code class="docutils literal notranslate"><span class="pre">copyRule</span></code> is run multiple times before we get the corresponding
transaction. Note that Daml triggers are expected to be designed such
that they can cope with this, e.g., after a restart or a crash where the
commands in flight do not contain commands in flight from before the
restart, so this is an optimization rather than something required for
them to function correctly.</p>
<p>First, we get all <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code>, <code class="docutils literal notranslate"><span class="pre">Original</span></code> and <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts
from the ACS. For that, the Daml trigger API provides a <code class="docutils literal notranslate"><span class="pre">query</span></code>
function that will return a list of all contracts of a given template.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">subscribers</span> <span class="kt">:</span> <span class="p">[(</span><span class="kt">ContractId</span> <span class="kt">Subscriber</span><span class="p">,</span> <span class="kt">Subscriber</span><span class="p">)]</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">Subscriber</span>
  <span class="n">originals</span> <span class="kt">:</span> <span class="p">[(</span><span class="kt">ContractId</span> <span class="kt">Original</span><span class="p">,</span> <span class="kt">Original</span><span class="p">)]</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">Original</span>
  <span class="n">copies</span> <span class="kt">:</span> <span class="p">[(</span><span class="kt">ContractId</span> <span class="kt">Copy</span><span class="p">,</span> <span class="kt">Copy</span><span class="p">)]</span> <span class="ow">&lt;-</span> <span class="n">query</span> <span class="o">@</span><span class="kt">Copy</span>
</pre></div>
</div>
<p>Now, we can filter those contracts to the ones where we are the
<code class="docutils literal notranslate"><span class="pre">owner</span></code> as described before.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="kr">let</span> <span class="n">ownedSubscribers</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">subscribedTo</span> <span class="o">==</span> <span class="n">party</span><span class="p">)</span> <span class="n">subscribers</span>
  <span class="kr">let</span> <span class="n">ownedOriginals</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">o</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">party</span><span class="p">)</span> <span class="n">originals</span>
  <span class="kr">let</span> <span class="n">ownedCopies</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">original</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">party</span><span class="p">)</span> <span class="n">copies</span>
</pre></div>
</div>
<p>We also need a list of all parties that have subscribed to us.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="kr">let</span> <span class="n">subscribingParties</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">subscriber</span><span class="p">)</span> <span class="n">ownedSubscribers</span>
</pre></div>
</div>
<p>As we have mentioned before, we only want to keep one <code class="docutils literal notranslate"><span class="pre">Copy</span></code> per
<code class="docutils literal notranslate"><span class="pre">Original</span></code> and <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code> and archive all others. Therefore, we
group identical <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contracts and keep the first of each group
while archiving the others.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="kr">let</span> <span class="n">groupedCopies</span> <span class="kt">:</span> <span class="p">[[(</span><span class="kt">ContractId</span> <span class="kt">Copy</span><span class="p">,</span> <span class="kt">Copy</span><span class="p">)]]</span>
      <span class="n">groupedCopies</span> <span class="ow">=</span> <span class="n">groupOn</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">sortOn</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">ownedCopies</span>
  <span class="kr">let</span> <span class="n">copiesToKeep</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">head</span> <span class="n">groupedCopies</span>
  <span class="kr">let</span> <span class="n">archiveDuplicateCopies</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">tail</span> <span class="n">groupedCopies</span>
</pre></div>
</div>
<p>In addition to duplicate copies, we also need to archive copies where
the corresponding <code class="docutils literal notranslate"><span class="pre">Original</span></code> or <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code> no longer exists.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="kr">let</span> <span class="n">archiveMissingOriginal</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">original</span> <span class="p">`</span><span class="n">notElem</span><span class="p">`</span> <span class="n">map</span> <span class="n">snd</span> <span class="n">ownedOriginals</span><span class="p">)</span> <span class="n">copiesToKeep</span>
  <span class="kr">let</span> <span class="n">archiveMissingSubscriber</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">subscriber</span> <span class="p">`</span><span class="n">notElem</span><span class="p">`</span> <span class="n">subscribingParties</span><span class="p">)</span> <span class="n">copiesToKeep</span>
  <span class="kr">let</span> <span class="n">archiveCopies</span> <span class="ow">=</span> <span class="n">dedup</span> <span class="o">$</span> <span class="n">map</span> <span class="n">fst</span> <span class="o">$</span> <span class="n">archiveDuplicateCopies</span> <span class="o">&lt;&gt;</span> <span class="n">archiveMissingOriginal</span> <span class="o">&lt;&gt;</span> <span class="n">archiveMissingSubscriber</span>
</pre></div>
</div>
<p>To send the corresponding archive commands to the ledger, we iterate
over <code class="docutils literal notranslate"><span class="pre">archiveCopies</span></code> using <code class="docutils literal notranslate"><span class="pre">forA</span></code> and call the <code class="docutils literal notranslate"><span class="pre">emitCommands</span></code>
function. Each call to <code class="docutils literal notranslate"><span class="pre">emitCommands</span></code> takes a list of commands which
will be submitted as a single transaction. The actual commands can be
created using <code class="docutils literal notranslate"><span class="pre">exerciseCmd</span></code> and <code class="docutils literal notranslate"><span class="pre">createCmd</span></code>. In addition to that,
we also pass in a list of contract ids. Those contracts will be marked
pending and not be included in the result of <code class="docutils literal notranslate"><span class="pre">query</span></code> until
the commands have either been committed to the ledger or the command
submission failed.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="n">forA</span> <span class="n">archiveCopies</span> <span class="o">$</span> <span class="nf">\</span><span class="n">cid</span> <span class="ow">-&gt;</span> <span class="n">emitCommands</span> <span class="p">[</span><span class="n">exerciseCmd</span> <span class="n">cid</span> <span class="kt">Archive</span><span class="p">]</span> <span class="p">[</span><span class="n">toAnyContractId</span> <span class="n">cid</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, we also need to create copies that do not already exists. We
want to avoid creating copies for which there is already a command in
flight. The Daml Trigger API provides a <code class="docutils literal notranslate"><span class="pre">dedupCreate</span></code> helper for this
which only sends the commands if it is not already in flight.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span>  <span class="kr">let</span> <span class="n">neededCopies</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Copy</span> <span class="n">m</span> <span class="n">o</span> <span class="o">|</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">ownedOriginals</span><span class="p">,</span> <span class="n">o</span> <span class="ow">&lt;-</span> <span class="n">subscribingParties</span><span class="p">]</span>
  <span class="kr">let</span> <span class="n">createCopies</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="p">`</span><span class="n">notElem</span><span class="p">`</span> <span class="n">map</span> <span class="n">snd</span> <span class="n">copiesToKeep</span><span class="p">)</span> <span class="n">neededCopies</span>
  <span class="n">mapA</span> <span class="n">dedupCreate</span> <span class="n">createCopies</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-daml-trigger">
<span id="id1"></span><h3>Running a Daml Trigger<a class="headerlink" href="#running-a-daml-trigger" title="Permalink to this headline">¶</a></h3>
<p>To try this example out, you can replicate it using
<code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">new</span> <span class="pre">copy-trigger</span> <span class="pre">--template</span> <span class="pre">copy-trigger</span></code>. You first have to build the trigger like
you would build a regular Daml project using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">build</span></code>.
Then start the sandbox and navigator using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">start</span></code>.</p>
<p>Now we are ready to run the trigger using <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">trigger</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>daml trigger --dar .daml/dist/copy-trigger-0.0.1.dar --trigger-name CopyTrigger:copyTrigger --ledger-host localhost --ledger-port <span class="m">6865</span> --ledger-party Alice
</pre></div>
</div>
<p>The first argument specifies the <code class="docutils literal notranslate"><span class="pre">.dar</span></code> file that we have just
built. The second argument specifies the identifier of the trigger
using the syntax <code class="docutils literal notranslate"><span class="pre">ModuleName:identifier</span></code>. Finally, we need to
specify the ledger host, port, the party that our trigger is executed
as, and the time mode of the ledger which is the sandbox default, i.e,
static time.</p>
<p>Now open Navigator at <a class="reference external" href="http://localhost:7500/">http://localhost:7500/</a>.</p>
<p>First, login as <code class="docutils literal notranslate"><span class="pre">Alice</span></code> and create an <code class="docutils literal notranslate"><span class="pre">Original</span></code> contract with
<code class="docutils literal notranslate"><span class="pre">party</span></code> set to <code class="docutils literal notranslate"><span class="pre">Alice</span></code>.  Now, logout and login as <code class="docutils literal notranslate"><span class="pre">Bob</span></code> and
create a <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code> contract with <code class="docutils literal notranslate"><span class="pre">subscriber</span></code> set to <code class="docutils literal notranslate"><span class="pre">Bob</span></code>
and <code class="docutils literal notranslate"><span class="pre">subscribedTo</span></code> set to <code class="docutils literal notranslate"><span class="pre">Alice</span></code>. After a short delay you should
now see a <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contract corresponding to the <code class="docutils literal notranslate"><span class="pre">Original</span></code> that you
have created as <code class="docutils literal notranslate"><span class="pre">Alice</span></code>. Once you archive the <code class="docutils literal notranslate"><span class="pre">Subscriber</span></code>
contract, you can see that the <code class="docutils literal notranslate"><span class="pre">Copy</span></code> contract will also be
archived.</p>
<p>When using Daml triggers against a Ledger with authentication, you can
pass <code class="docutils literal notranslate"><span class="pre">--access-token-file</span> <span class="pre">token.jwt</span></code> to <code class="docutils literal notranslate"><span class="pre">daml</span> <span class="pre">trigger</span></code> which will
read the token from the file <code class="docutils literal notranslate"><span class="pre">token.jwt</span></code>.</p>
</div>
</div>
<div class="section" id="when-not-to-use-daml-triggers">
<h2>When not to use Daml triggers<a class="headerlink" href="#when-not-to-use-daml-triggers" title="Permalink to this headline">¶</a></h2>
<p>Daml Triggers are not suited for automation that needs to interact
with services or data outside of the ledger. For those cases, you can
write a ledger client using the
<a class="reference internal" href="../app-dev/bindings-ts/index.html"><span class="doc">JavaScript bindings</span></a>
running against the HTTP JSON API or the
<a class="reference internal" href="../app-dev/bindings-java/index.html"><span class="doc">Java bindings</span></a> running against the
gRPC Ledger API.</p>
<p>Daml triggers deliberately only allow you to express automation that
listens for ledger events and reacts to them by sending commands to
the ledger.</p>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../app-dev/bindings-x-lang/index.html" class="da-btn da-btn-label btn-prev" title="Creating your own bindings" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="api/index.html" class="da-btn da-btn-label btn-next" title="Daml Trigger Library" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>